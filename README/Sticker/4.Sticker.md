# Sticker

- ì´ë²ˆ ì‹œê°„ì—ëŠ” `Exploration` 3ë²ˆì— ìˆëŠ” ë…¸ë“œë¥¼ ì„œë²„ë¥¼ í†µí•´ `Web`ì—ì„œ ì‘ë™í• ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
<p align="center"><img src="./img/4.png"></p>
<p align="center"><img src="./img/3.png"></p>

- ë¨¼ì € í•´ë‹¹ ì±•í„°ì˜ ë‚´ìš©ì„ í•˜ê¸°ì „ì— í´ë”ë¥¼ ëª‡ê°€ì§€ ë§Œë“¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- í”„ë¡œì íŠ¸ í´ë” ì•ˆì— `stickerUtil`ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- ê·¸ë¦¬ê³  ê·¸ì•ˆì— AIê°€ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•œ ì´ë¯¸ì§€ë¥¼ ë‹´ëŠ” `images`ì™€ `LandMark`ëª¨ë¸ì„ ë‹´ì„ `models` í´ë”ë¥¼ ë§Œë“¤ì–´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```console

fristproject
â”œâ”€â”€â”€config
â”œâ”€â”€â”€Landing
â”œâ”€â”€â”€static
â”œâ”€â”€â”€templatesasssssds
â””â”€â”€â”€stickerUtil
    â”œâ”€â”€â”€images
    â””â”€â”€â”€models
```

- ë§ˆì§€ë§‰ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¡œ ì‚¬ìš©ë  `image.png` ì™€ ìŠ¤í‹°ì»¤ê°€ ë  `king.png`ë¥¼ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤ .

- `image.png` : ì›í•˜ëŠ” ì‚¬ëŒì‚¬ì§„ í•œì¥ìœ¼ë¡œ ì˜¬ë ¤ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

- `king.png` : https://drive.google.com/file/d/1knZtRmrsXVqYutibA9O06QVhFXb4oWl4/view?usp=sharing

```console

fristproject
â”œâ”€â”€â”€config
â”œâ”€â”€â”€Landing
â”œâ”€â”€â”€static
â”œâ”€â”€â”€templates
â””â”€â”€â”€stickerUtil
    â”œâ”€â”€â”€images
    â”‚   â”œâ”€â”€ image.png
    â”‚   â””â”€â”€ king.png
    â””â”€â”€â”€models
```

- ê·¸ëŸ¼ ìŠ¤í‹°ì»¤ë¥¼ ë¶™ì—¬ì£¼ëŠ” ì¸ê³µì§€ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” ì½”ë“œëŠ” `stickerUtil` í´ë”ì•ˆì— `sticker.py`ë¼ëŠ” ëª…ì¹­ìœ¼ë¡œ ê´€ë¦¬í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```console
fristproject
â”œâ”€â”€â”€config
â”œâ”€â”€â”€Landing
â”œâ”€â”€â”€static
â”œâ”€â”€â”€templates
â””â”€â”€â”€stickerUtil
    â”œâ”€â”€â”€sticker.py
    â”œâ”€â”€â”€images
    â”‚   â”œâ”€â”€ image.png
    â”‚   â””â”€â”€ king.png
    â””â”€â”€â”€models
```

- í•˜ì§€ë§Œ ì½”ë“œ ì‘ì„± ì´ì „ì— ìš°ë¦¬ê°€ í•„ìš”í•œ `library`ë“¤ì„ ì„¤ì¹˜í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
pip install opencv-python
pip install matplotlib
pip install cmake
pip install dlib
```

> ì—¬ê¸°ì„œ `dlib`ì´ `window`ì—ì„œ ì„¤ì¹˜ê°€ ì˜ë˜ì§€ ì•Šì„ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
> [Dlib ì„¤ì¹˜ ë°©ë²•](https://sulastri.tistory.com/3)

- ë¨¼ì € `Exploration`ì— ìˆëŠ” `ìŠ¤í‹°ì»¤ ë¶™ì´ê¸°` ì±•í„°ì˜ ë‚´ìš©ì„ ë”°ë¼ì„œ ì½”ë“œë¥¼ ì³ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
import os
import cv2
import matplotlib.pyplot as plt
import numpy as np
import dlib
print("ğŸ›¸")
```

- ê²°ê³¼ë¬¼ì´ `ğŸ›¸`ì´ ë‚˜ì˜¤ëŠ”ê²ƒì„ ë³¼ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```py
my_image_path = os.path.dirname(__file__) +'/images/image.png'
my_image_path_encode= np.fromfile(my_image_path, np.uint8)
img_bgr = cv2.imdecode(my_image_path_encode,cv2.IMREAD_UNCHANGED)    # OpenCVë¡œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤
img_show = img_bgr.copy()      # ì¶œë ¥ìš© ì´ë¯¸ì§€ë¥¼ ë”°ë¡œ ë³´ê´€í•©ë‹ˆë‹¤

plt.imshow(img_bgr)
plt.show()
```

- í•´ë‹¹ ê²°ê³¼ë¬¼ë¡œ ìš°ë¦¬ê°€ ì§€ì •í•œ ì‚¬ì§„ì´ ë‚˜ì˜¤ëŠ”ê±¸ í™•ì¸í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```py
detector_hog = dlib.get_frontal_face_detector()
img_rgb = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2RGB)
dlib_rects = detector_hog(img_rgb, 1)   # (image, num of image pyramid)
    for dlib_rect in dlib_rects:
        l = dlib_rect.left()
        t = dlib_rect.top()
        r = dlib_rect.right()
        b = dlib_rect.bottom()

        cv2.rectangle(img_show, (l,t), (r,b), (0,255,0), 2, lineType=cv2.LINE_AA)

img_show_rgb =  cv2.cvtColor(img_show, cv2.COLOR_BGR2RGB)
plt.imshow(img_show_rgb)
plt.show()

```

- ì ì´ì œ ì´ë¯¸ì§€ ë°•ìŠ¤ì— ì´ˆë¡ìƒ‰ ë„¤ëª¨ê°€ ìƒê¸°ê²Œ ë ê±°ì—ìš”( ë‹¤ë“¤ ì•Œê³  ê³„ì‹œì£ ? ã…ã… )

- ì´ì œ `Dlib`ì„ í†µí•´ `LandMark`ë¥¼ ì„¸ì›Œë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- ë¨¼ì € ì•„ë˜ `URL`ì„ í†µí•´ `LandMark`íŒŒì¼ì„ ì„¤ì¹˜í•˜ì‹œê³ , ì••ì¶•ì„ í’€ì–´ `shape_predictor_68_face_landmarks.dat`íŒŒì¼ì„ êº¼ë‚´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

[LandMark](http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2)

- `shape_predictor_68_face_landmarks.dat` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ë„£ì–´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```console
fristproject
â”œâ”€â”€â”€config
â”œâ”€â”€â”€Landing
â”œâ”€â”€â”€static
â”œâ”€â”€â”€templates
â””â”€â”€â”€stickerUtil
    â”œâ”€â”€â”€sticker.py
    â”œâ”€â”€â”€images
    â”‚   â”œâ”€â”€â”€ image.png
    â”‚   â””â”€â”€â”€ king.png
    â””â”€â”€â”€models
        â””â”€â”€â”€shape_predictor_68_face_landmarks.dat
```

- `bounding box` ë”°ë¼ ëœë“œë§ˆí¬ë¥¼ ì°ì–´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- ì´ë•Œ `model_path`ëŠ” í•œê¸€ê²½ë¡œê°€ ìˆì„ê²½ìš° ì˜ ëŒì•„ê°€ì§€ ì•Šì„ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```py
    # Section 4
    # LandMark ì°ê¸°
model_path = os.path.dirname(__file__) + '/models/shape_predictor_68_face_landmarks.dat'
landmark_predictor = dlib.shape_predictor(model_path)

list_landmarks = []
    # ì–¼êµ´ ì˜ì—­ ë°•ìŠ¤ ë§ˆë‹¤ face landmarkë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤
    for dlib_rect in dlib_rects:
        points = landmark_predictor(img_rgb, dlib_rect)
        # face landmark ì¢Œí‘œë¥¼ ì €ì¥í•´ë‘¡ë‹ˆë‹¤
        list_points = list(map(lambda p: (p.x, p.y), points.parts()))
        list_landmarks.append(list_points)
```

- ì´ì œ `LandMark`ê°€ ì œëŒ€ë¡œ ì°í˜”ëŠ”ì§€ í™•ì¸ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
  # Section 5
    # LandMark ì¶œë ¥

for landmark in list_landmarks:
    for point in landmark:
        cv2.circle(img_show, point, 2, (0, 255, 255), -1)

img_show_rgb = cv2.cvtColor(img_show, cv2.COLOR_BGR2RGB)
plt.imshow(img_show_rgb)
plt.show()
```

- `LandMark`ê°€ ì°íˆëŠ”ê²Œ í™•ì¸ì´ ë˜ì—ˆìœ¼ë©´ ì´ì œ ìŠ¤í‹°ì»¤ë¥¼ ë¶™ì´ê³  ì •ë¦¬ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
for dlib_rect, landmark in zip(dlib_rects, list_landmarks):
    x = landmark[30][0]
    y = landmark[30][1] - dlib_rect.height()//2
    w = h = dlib_rect.width()

    # ìŠ¤í‹°ì»¤ ì‚¬ì´ì¦ˆ ì¡°ì ˆ
sticker_path = os.path.dirname(__file__) + '/images/king.png'
img_sticker = cv2.imread(sticker_path) # ìŠ¤í‹°ì»¤ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤
img_sticker = cv2.resize(img_sticker, (w,h))

    # ìŠ¤í‹°ì»¤ìœ„ì¹˜ ì¡°ì •
refined_x = x - w // 2
refined_y = y - h

    # ìŠ¤í‹°ì»¤ ìœ„ì¹˜ ë„˜ì–´ê°€ë©´ ì˜ë¦¬ê²Œ
if refined_x < 0:
    img_sticker = img_sticker[:, -refined_x:]
    refined_x = 0
if refined_y < 0:
    img_sticker = img_sticker[-refined_y:, :]
    refined_y = 0

    # ì‚¬ì§„ì— ì ìš©í›„ ì¶œë ¥
sticker_area = img_bgr[refined_y:refined_y +img_sticker.shape[0], refined_x:refined_x+img_sticker.shape[1]]
img_bgr[refined_y:refined_y +img_sticker.shape[0], refined_x:refined_x+img_sticker.shape[1]] = \
    np.where(img_sticker==0,sticker_area,img_sticker).astype(np.uint8)

plt.imshow(cv2.cvtColor(img_bgr, cv2.COLOR_BGR2RGB))
plt.show()
```

- ê·¸ëŸ¼ `python sticker.py`ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ì‚¬ì§„ì— ìŠ¤í‹°ì»¤ê°€ ë¶™ì—¬ì ¸ì„œ ë‚˜ì˜¤ëŠ”ê±¸ í™•ì¸ í• ìˆ˜ìˆìŠµë‹ˆë‹¤.

- ì´ì œ ì¥ê³ ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë°›ì„ìˆ˜ ìˆë„ë¡ ì‚¬ì´íŠ¸ë¥¼ ë‘ê°œ ë§Œë“¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- ì²«ë²ˆì§¸ ì‚¬ì´íŠ¸ëŠ” `input`ì„ í†µí•´ ì´ë¯¸ì§€ë¥¼ ë°›ëŠ”ì—­í• ì„ í•˜ê³  ë‘ë²ˆì§¸ ì‚¬ì´íŠ¸ëŠ” `ouput`ì„ í™”ë©´ì— ë³´ì—¬ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

- ê·¸ëŸ¼ ë¨¼ì € `html` íŒŒì¼ì„ ë‘ê°œë¥¼ ë§Œë“¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- `stickerResult.html` : `image`ë¥¼ ë³´ì—¬ì£¼ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sticker AI view</title>
  </head>
  <body>
    <div>
      <img src="{{ image }}" style="width: 40vw" alt="convertImage" />
    </div>
  </body>
</html>
```

- `sticker.html`: `input`íƒœê·¸ë¥¼ í†µí•´ ì´ë¯¸ì§€ë¥¼ ë°›ê²Œ ë˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sticker AI</title>
  </head>
  <body>
    <div class="container">
      <!-- form actionì„ í†µí•´ ì´ë¯¸ì§€ê°€ ì „ì†¡ì´ ë˜ì—ˆì„ë•Œ ì²˜ë¦¬í•  ë‚´ìš©ë¬¼ì´ ì „ë‹¬ì´ ë˜ë©´ í˜ì´ì§€ ì´ë™-->
      <form
        method="POST"
        action="{% url 'stickerResult' %}"
        enctype="multipart/form-data"
      >
        {% csrf_token %}
        <input type="file" name="image" /><br />
        <input type="submit" value="í…ŒìŠ¤íŠ¸ í•´ë³´ê¸° " />
      </form>
    </div>
  </body>
</html>
```

- ì´ì œ `html`ì„ ë³´ì—¬ì£¼ëŠ”ê±¸ ë‹´ë‹¹í•˜ëŠ” `views.py`ì—ì„œ ì„¤ì •ì„ í•´ì£¼ê² ìŠµë‹ˆë‹¤.

- ì¼ë‹¨ `sticker`ëŠ” ë‹¨ìˆœí•˜ê²Œ í˜ì´ì§€ë§Œ ë³´ì—¬ì£¼ë©´ ë˜ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ì¹˜ë©´ë©ë‹ˆë‹¤.

```py
# views.py
def sticker(req):
    return render(req,'Landing/sticker.html')

```

- `stickerResult`ëŠ” ì´ë¯¸ì§€ì—ì„œ ë°›ì€ ê°’ì„ ê°€ê³µí•´ì„œ ë‹¤ì‹œ ì˜¬ë ¤í•˜ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„œ ì°¨ì´ê°€ ìˆì„ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- `POST`í†µì‹ ê³¼ `GET` í†µì‹ ì— ëŒ€í•´ì„  ì•ì„œ `Figma`ë¥¼ í†µí•´ ì„¤ëª…ì„ ë“œë ¸ìŠµë‹ˆë‹¤.

- ì´ë¯¸ì§€ë¥¼ ë³´ë‚¼ìˆ˜ ìˆëŠ”ê±´ `POST` í†µì‹ ì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ í†µì‹ ì´ ì™”ì„ë•Œ ì´ë¯¸ì§€ë¥¼ ì²˜ë¦¬í•´ì„œ `sticekrResult.html`ì— ë³´ë‚´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
# views.py
def stickerResult(request):
    if request.method == 'POST': # í†µì‹ ì´ postì¼ë•Œ
        try:
            img = request.FILES["image"].read() # í†µì‹ ì—ì„œ iamgeë¥¼ ì½ì–´ ë“œë¦¬ë„ë¡ í•œë‹¤.
            convertImg = ì¸ê³µì§€ëŠ¥ ì½”ë“œ  # ì¸ê³µì§€ëŠ¥ ì½”ë“œë¥¼ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.
            return render(request, 'Landing/stickerResult.html', {'image':convertImg}) # stickerResult.htmlì„ ë³´ì—¬ì¤„ë•Œ ê°€ê³µí•œ imageíŒŒì¼ë„ ê°™ì´ ë„˜ê¸´ë‹¤
        except:
            return   HttpResponse("ë³´ì—¬ì¤„ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!") # image íŒŒì¼ì´ ì—†ìœ¼ë©´ ì²˜ë¦¬
    else:
        return   HttpResponse("ë³´ì—¬ì¤„ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!") # post í†µì‹ ì´ ì•„ë‹ˆë©´ ìë£Œë¥¼ ë³´ë‚¼ìˆ˜ ì—†ì–´ì„œ ì˜ˆì™¸ ì²˜ë¦¬
```

- ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ë ‡ê²Œ `views`ì—ì„œ ì—´ì‹¬íˆ ì‘ì„±í•œ í•¨ìˆ˜ë¥¼ `urls.py`ì—ì„œ ì—°ê²°ì‹œì¼œ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
urlpatterns = [
    path('admin/', admin.site.urls),
    path('',Landing.views.index,name="index"),
    path('study',Landing.views.study,name="study"),
    path('sticker',Landing.views.sticker,name="sticker"), #ìŠ¤í‹°ì»¤ ì…ë ¥í•˜ëŠ” í˜ì´ì§€
    path('stickerResult',Landing.views.stickerResult,name="stickerResult") #ìŠ¤í‹°ì»¤ ë³´ì—¬ì£¼ëŠ” í˜ì´ì§€
]

```

- ì´ì œ ë‹¤ì‹œ ì¸ê³µì§€ëŠ¥ ì½”ë“œë¥¼ ë‹¤ë“¬ì„ë•Œê°€ ì™”ìŠµë‹ˆë‹¤.

- ë¨¼ì € ì´ì œëŠ” íŒŒì´ì¬ì„ í†µí•´ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì¤„ í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— `plt.imshow`, `plt.show` í•¨ìˆ˜ë¥¼ ë‚ ë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- ê·¸ë¦¬ê³  `opencv`ë¥¼ í†µí•´ ê°€ê³µí•œ ì´ë¯¸ì§€ë¥¼ ì½ì„ìˆ˜ ìˆë„ë¡ ë³€í™˜í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ëª‡ê°€ì§€ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
import os
import cv2
import matplotlib.pyplot as plt
import numpy as np
import dlib
import base64

file_dir = os.path.dirname(__file__)

def stickerGen(img):
    img_bgr = cv2.imdecode(np.fromstring(img, np.uint8), cv2.IMREAD_UNCHANGED)
    detector_hog = dlib.get_frontal_face_detector()

    img_rgb = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2RGB)
    dlib_rects = detector_hog(img_rgb, 1)

    model_path = file_dir+'/models/shape_predictor_68_face_landmarks.dat'
    landmark_predictor = dlib.shape_predictor(model_path)

    list_landmarks = []

    for dlib_rect in dlib_rects:
        points = landmark_predictor(img_rgb, dlib_rect)
        list_points = list(map(lambda p: (p.x, p.y), points.parts()))
        list_landmarks.append(list_points)

    for dlib_rect, landmark in zip(dlib_rects, list_landmarks):
        x = landmark[30][0]
        y = landmark[30][1] - dlib_rect.height()//2
        w = h = dlib_rect.width()

    sticker_path = file_dir+'/images/king.png'
    img_sticker = cv2.imread(sticker_path)
    img_sticker = cv2.resize(img_sticker, (w,h))

    refined_x = x - w // 2
    refined_y = y - h

    if refined_x < 0:
        img_sticker = img_sticker[:, -refined_x:]
        refined_x = 0
    if refined_y < 0:
        img_sticker = img_sticker[-refined_y:, :]
        refined_y = 0

    sticker_area = img_bgr[refined_y:refined_y +img_sticker.shape[0], refined_x:refined_x+img_sticker.shape[1]]
    img_bgr[refined_y:refined_y +img_sticker.shape[0], refined_x:refined_x+img_sticker.shape[1]] = \
        np.where(img_sticker==0,sticker_area,img_sticker).astype(np.uint8)

    img_bgr_buffer= cv2.imencode('.jpg', img_bgr)[1]
    result = base64.b64encode(img_bgr_buffer).decode("utf-8")
    return result

```

- í•´ë‹¹ ì½”ë“œë¥¼ ìœ„ì™€ ê°™ì´ ìˆ˜ì •í•˜ì‹œê³  `views.py`ì—ì„œ ì¸ê³µì§€ëŠ¥ì„ ë³´ì—¬ì£¼ëŠ” ì½”ë“œ ì—­ì‹œ ì•„ë˜ì™€ ê°™ì´ ë°”ê¿”ì£¼ë„ë¡ í•©ì‹œë‹¤.

```py
from django.shortcuts import render
from django.core.files.storage import default_storage
# httpResponseë¥¼ ìœ„í•´ ì„í¬íŠ¸
from django.http import HttpResponse
# ì¸ê³µì§€ëŠ¥ì„ ê´€ë¦¬í•˜ëŠ” ì½”ë“œ ì„í¬íŠ¸
from stickerUtil.sticker import stickerGen


# Create your views here.
#views.py
def index(req):
    return render(req,'Landing/index.html')

def sticker(req):
    return render(req,'Landing/sticker.html')

def study(req):
    return render(req,'Landing/study.html')


def stickerResult(request):
    if request.method == 'POST': # í†µì‹ ì´ postì¼ë•Œ
        try:
            imgMemory= request.FILES["image"] # í†µì‹ ì—ì„œ iamgeë¥¼ inmemoryì— ì €ì¥ë˜ì–´ ìˆëŠ” ê°’ìœ¼ë¡œ ì½ì–´ ë“œë¦¬ë„ë¡ í•œë‹¤.
            imgByte = imgMemory.read() # í†µì‹ ì—ì„œ iamgeë¥¼ Byteë¡œ ì½ì–´ ë“œë¦¬ë„ë¡ í•œë‹¤.
            convertImg = "data:image/jpg;base64, "+str(stickerGen(imgByte)) # Html img íƒœê·¸ì—ì„œ ì¶œë ¥í• ìˆ˜ ìˆë„ë¡ base64 íƒ€ì…ìœ¼ë¡œ ë³€í™˜
            return render(request, 'Landing/stickerResult.html', {'image':convertImg}) # stickerResult.htmlì„ ë³´ì—¬ì¤„ë•Œ ê°€ê³µí•œ imageíŒŒì¼ë„ ê°™ì´ ë„˜ê¸´ë‹¤
        except:
            return   HttpResponse("ë³´ì—¬ì¤„ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!") # image íŒŒì¼ì´ ì—†ìœ¼ë©´ ì²˜ë¦¬
    else:
        return   HttpResponse("ë³´ì—¬ì¤„ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!") # post í†µì‹ ì´ ì•„ë‹ˆë©´ ìë£Œë¥¼ ë³´ë‚¼ìˆ˜ ì—†ì–´ì„œ ì˜ˆì™¸ ì²˜ë¦¬
```

- ì´ì œ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œì¼œ ì˜ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```console
python manage.py runserver
```

- `http://127.0.0.1:8000/sticker`ì— ì ‘ì†ì„ í•˜ì‹œë©´ ì•„ë˜ ì‚¬ì§„ì²˜ëŸ¼ ë²„íŠ¼ë‘ê°œê°€ ë³´ì´ê²Œ ë ê²ë‹ˆë‹¤.

<p align="center"><img src="./img/1.png"></p>

- íŒŒì¼ ì„ íƒì„ ëˆ„ë¥´ë©´ ì´ë¯¸ì§€ë¥¼ ì„ íƒí• ìˆ˜ ìˆê²Œ ë˜ì–´ ì›í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì°¾ì•„ ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

<p align="center"><img src="./img/2.png"></p>

- ì‚¬ì§„ì„ ë„£ì–´ì£¼ì‹œë©´ ì‚¬ëŒ ì–¼êµ´ì— ì™•ê´€ì´ ìˆëŠ”ê²ƒì„ í™•ì¸í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<p align="center"><img src="./img/3.png"></p>

## ê·¸ëŸ°ë°!

- ë§Œì•½ ì—¬ëŸ¬ë¶„ì´ ì…ë ¥ë°›ì€ ì‚¬ì§„ê³¼ ì²˜ë¦¬í•œ ì‚¬ì§„ì„ ì €ì¥í•´ ì»´í“¨í„°ì— ë‚¨ê¸°ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œìš”?

- ì´ ê²½ìš°ì—ëŠ” 2ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

  - ì²«ë²ˆì§¸ëŠ” `DataBase`ë¥¼ ì‚¬ìš©í•´ íŒŒì¼ì„ ë¹„ë¡¯í•´ ìš°ë¦¬ê°€ ì‚¬ìš©í•´í•˜ëŠ” ìë£Œë“¤ì„ ì €ì¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

  - ë‘ë²ˆì§¸ëŠ” `Django`ì—ì„œ ê°€ë²¼ìš´ íŒŒì¼ì •ë„ë¥¼ ì €ì¥í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•˜ëŠ” `default_storage`ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒì…ë‹ˆë‹¤.

- ì˜¤ëŠ˜ì€ `default_storage`ë¥¼ ì‚¬ìš©í•´ íŒŒì¼ì„ ì €ì¥í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- ì´ ê³¼ì •ì€ í¬ê²Œ 3ê°€ì§€ë¡œ `settings.py` , `urls.py`, `views.py`ì—ì„œ ì‘ì—…ì„ í•´ì•¼í•©ë‹ˆë‹¤.

- ë˜í•œ ìŠ¤í‹°ì»¤ë¥¼ ë¶™ì¸ ì½”ë“œë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ì„œëŠ” ì¶”ê°€ì ìœ¼ë¡œ `cv2.imwrite()`í•¨ìˆ˜ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ í•´ì•¼í•©ë‹ˆë‹¤.

- `settings.py`ì—ì„œ `default_storage`ì˜ ìœ„ì¹˜ë¥¼ `media`ë¼ëŠ” í´ë”ë¡œ ì„ ì •í•´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
# Base_DIR ê¹Œì§€ëŠ” ìš°ë¦¬ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
BASE_DIR = Path(__file__).resolve().parent.parent.parent

# ì´ ë°‘ì— mediaë¼ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ë‘ì–´ ì €ì¥ì†Œì˜ ìœ„ì¹˜ë¥¼ ì„ ì •í•˜ê² ìŠµë‹ˆë‹¤.
MEDIA_ROOT = BASE_DIR / 'media'
```

- `urls.py`ì—ì„œ `media`íŒŒì¼ì„ ìë™ìœ¼ë¡œ ì˜®ê²¨ì¤„ìˆ˜ ìˆë„ë¡ ì½”ë“œë¥¼ í•œì¤„ ìˆ˜ì •í•´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
from django.contrib import admin
from django.urls import include,path
from django.conf import settings
from django.conf.urls.static import static
import Landing.views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('',Landing.views.index,name="index"),
    path('study',Landing.views.study,name="study"),
    path('sticker',Landing.views.sticker,name="sticker"),
    path('stickerResult',Landing.views.stickerResult,name="stickerResult")
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

- `views.py`ì—ì„œ ì‘ì„±í–ˆë˜ `stickerResult` í•¨ìˆ˜ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë°›ìœ¼ë©´ `default_storage(media í´ë”)`ì— ì €ì¥í• ìˆ˜ ìˆë„ë¡ ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ê² ìŠµë‹ˆë‹¤.

- ìš°ë¦¬ëŠ” ë°›ì€ ì´ë¯¸ì§€ë¥¼ `media`í´ë” ì•ˆì— `bfImages`ë¼ëŠ” ê³»ê°„ì— ì €ì¥í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- ì´ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” `Django`ì— `memory`ì— ì˜¬ë¼ì™€ìˆëŠ” íŒŒì¼ì„ ì €ì¥í•´ì•¼í•©ë‹ˆë‹¤.

- ë”°ë¼ì„œ `imgMemory`ë¥¼ í†µí•´ì„œ ì‚¬ì§„ì„ ë°”ë¡œ ì €ì¥í• ìˆ˜ ìˆê²Œ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- ìˆ˜ì •ëœ ì½”ë“œ

```py

def stickerResult(request):
    if request.method == 'POST': # í†µì‹ ì´ postì¼ë•Œ
        try:
            imgMemory= request.FILES["image"] # í†µì‹ ì—ì„œ iamgeë¥¼ inmemoryì— ì €ì¥ë˜ì–´ ìˆëŠ” ê°’ìœ¼ë¡œ ì½ì–´ ë“œë¦¬ë„ë¡ í•œë‹¤.
            imgByte = imgMemory.read() # í†µì‹ ì—ì„œ iamgeë¥¼ Byteë¡œ ì½ì–´ ë“œë¦¬ë„ë¡ í•œë‹¤.
            if default_storage.exists("bfImages/"+str(imgMemory)) == False:
                default_storage.save("bfImages/"+str(imgMemory), imgMemory)
            convertImg = "data:image/jpg;base64, "+str(stickerGen(img)) # Html img íƒœê·¸ì—ì„œ ì¶œë ¥í• ìˆ˜ ìˆë„ë¡ base64 íƒ€ì…ìœ¼ë¡œ ë³€í™˜
            return render(request, 'Landing/stickerResult.html', {'image':convertImg}) # stickerResult.htmlì„ ë³´ì—¬ì¤„ë•Œ ê°€ê³µí•œ imageíŒŒì¼ë„ ê°™ì´ ë„˜ê¸´ë‹¤
        except:
            return   HttpResponse("ë³´ì—¬ì¤„ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!") # image íŒŒì¼ì´ ì—†ìœ¼ë©´ ì²˜ë¦¬
    else:
        return   HttpResponse("ë³´ì—¬ì¤„ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!") # post í†µì‹ ì´ ì•„ë‹ˆë©´ ìë£Œë¥¼ ë³´ë‚¼ìˆ˜ ì—†ì–´ì„œ ì˜ˆì™¸ ì²˜ë¦¬
```

- ì—¬ê¸°ì„œ ëª‡ëª‡ ë¶„ë“¤ì€ `requset`ì™€ `default_stroage`ì—ì„œ íŒŒì¼ì„ ì½ëŠ” ê³¼ì •ì—ì„œ ì—¬ëŸ¬ê°€ì§€ í•¨ìˆ˜ë“¤ì„ ì ìš© ì‹œí‚¬ìˆ˜ ìˆë‹¤ëŠ”ì„ ëŠë¼ì…¨ì„ê±´ë° ì°¨ì´ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```py
    #request
    print(type(request.FILES["file"]))              #<class 'django.core.files.uploadedfile.InMemoryUploadedFile'>

    print(type(request.FILES.get('file')))          #<class 'django.core.files.uploadedfile.InMemoryUploadedFile'>

    print(request.FILES.get('file'))                #bank.png

    imageFile = request.FILES.get('file')

    print(imageFile.size)                           #119227

    print(request.FILES.get('file').name)           #bank.png

    print(request.FILES.get('file').content_type)   #image/png

    print(type(request.FILES.get('file').open()))   #<class 'NoneType'>

    print(request.FILES.get('file').open())         #None

    #default_storage
    path = default_storage.save('path/to/file', file) # ì§€ì •ëœ ê²½ë¡œì— íŒŒì¼ ì €ì¥

    default_storage.size(path) # íŒŒì¼ ì „ì²´ í¬ê¸°(byte)

    default_storage.open(path).read() # ì§€ì •ëœ íŒŒì¼ ì—´ê¸°

    default_storage.delete(path) # ì§€ì •ëœ íŒŒì¼ ì‚­ì œ

    default_storage.exists(path) # ì§€ì •ëœ íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ (False || True)
```

- ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ë˜‘ê°™ì´ ì‚¬ì´íŠ¸ë¥¼ ì´ìš©í•´ ë³´ë©´ `media`ë¼ëŠ” í´ë”ê°€ ìƒê¸°ê²Œ ë˜ê³  `bfimages`ë¼ëŠ” í´ë”ì•ˆì— ì‚¬ì§„ì´ ë“¤ì–´ê°„ê²ƒì„ í™•ì¸í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ë§ˆì§€ë§‰ìœ¼ë¡œ ìŠ¤í‹°ì»¤ë¥¼ ë¶™ì¸ ì‚¬ì§„ì„ ì €ì¥í•˜ê¸° ìœ„í•´ `sticker.py`ì—ì„œ ì‚¬ì§„ì„ ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€ í•´ì•¼í•©ë‹ˆë‹¤.

- ì‚¬ì§„ì„ ì €ì¥í•˜ëŠ” ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ì€ë° ì € ì½”ë“œë¥¼ ì–´ë”˜ê°€ì— ì‚½ì…í•´ì„œ `media`ì— `afImages`ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê³  ê·¸ì•ˆì— ì €ì¥í•˜ë„ë¡ ë§Œë“¤ì–´ ë³´ëŠ”ê²ƒì„ ìˆ™ì œë¡œ ë‚´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```py
cv2.imwrite("ê²½ë¡œ/afImages/íŒŒì¼ëª….jpg", img_bgr)

```
